<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>图片懒加载</title>
  <style>
    *{
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    .image-item{
      width: 500px;
      height: 500px;
      margin-bottom: 20px;
    }
    body{
        background-color: aqua;
    }
  </style>
</head>
<body>
  <img  class="image-item" lazyload="true" src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif" data-original="https://img.36krcdn.com/hsossms/20250313/v2_15ad8ef9eca34830b4a2e081bbc7f57a@000000_oswg172644oswg1536oswg722_img_000?x-oss-process=image/resize,m_mfit,w_960,h_400,limit_0/crop,w_960,h_400,g_center" />
  <img  class="image-item" lazyload="true"  src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif" data-original="https://img.36krcdn.com/hsossms/20250312/v2_aeaa7a1d51e74c3a8f909c96cd73a687@000000_oswg169950oswg1440oswg600_img_jpeg?x-oss-process=image/format,webp" />
  <img  class="image-item" lazyload="true"  src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif" data-original="https://img.36krcdn.com/hsossms/20250312/v2_1c88dc26ff9341cf8738d670896ce3a8@5284654_oswg847922oswg1440oswg600_img_png?x-oss-process=image/resize,m_mfit,w_960,h_400,limit_0/crop,w_960,h_400,g_center/format,webp" />
  <img class="image-item" lazyload="true" src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif" data-original="https://img.36krcdn.com/hsossms/20250312/v2_e1d92f43af2c4f47b8852ea8786e606f@6100851_oswg635095oswg1053oswg495_img_png?x-oss-process=image/resize,m_mfit,w_960,h_400,limit_0/crop,w_960,h_400,g_center/format,webp" />
  <img  class="image-item" lazyload="true"  src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif" data-original="https://img.36krcdn.com/hsossms/20250307/v2_9295b22d4a1b4b55ac4c3379b2da80cc@6100851_oswg781048oswg1053oswg495_img_png?x-oss-process=image/resize,m_mfit,w_600,h_400,limit_0/crop,w_600,h_400,g_center/format,webp" />
  <img  class="image-item" lazyload="true"  src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif"data-original="https://img.36krcdn.com/hsossms/20250306/v2_6ea048ac01c3408a9ed6ebe79a8fc8a2@5888275_oswg849213oswg1053oswg495_img_png?x-oss-process=image/resize,m_mfit,w_600,h_400,limit_0/crop,w_600,h_400,g_center/format,webp" />
  <img  class="image-item" lazyload="true"  src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif"data-original="https://img.36krcdn.com/hsossms/20250312/v2_e4c73b024bcc409fba427adb2d7fb2fa@000000_oswg1251602oswg1080oswg559_img_000?x-oss-process=image/format,jpg/interlace,1" />
  <img class="image-item" lazyload="true" src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif" data-original="https://img.36krcdn.com/hsossms/20250312/v2_9f21750bb37243128b6b1790f9072649@000000_oswg1219724oswg1080oswg601_img_000?x-oss-process=image/format,jpg/interlace,1" />
  <img  class="image-item" lazyload="true"  src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif"data-original="https://img.36krcdn.com/hsossms/20250312/v2_2acf9b228cd940c1b5fdb5691c0b6e4c@000000_oswg1402679oswg1080oswg527_img_000?x-oss-process=image/format,jpg/interlace,1" />
  <img  class="image-item" lazyload="true"  src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif"data-original="https://img.36krcdn.com/hsossms/20250313/v2_e7de1cc8e8014122ba303ea036eea532@1743780481_oswg58583oswg1080oswg257_img_000?x-oss-process=image/format,jpg/interlace,1" />
  <img  class="image-item" lazyload="true"  src="https://static.360buyimg.com/item/main/1.0.12/css/i/loading.gif"data-original="https://img.36krcdn.com/hsossms/20250313/v2_0f70e0a75a8d4736a050e846cd6ab3e5@1743780481_oswg183216oswg1080oswg629_img_000?x-oss-process=image/format,jpg/interlace,1" />
  <script>
    const viewHeight = document.documentElement.clientHeight;//可视区域的高度 
    //doucument文档对象 doucumentElement文档元素
    //doucument.documentElement代表整个文档的根元素，即<html>元素。
    //console.log(viewHeight);
    const eles = document.querySelectorAll('img[data-original][lazyload]');//获取所有的图片元素
    //需要做懒加载lazyload,并且有data-original属性的图片元素 img[data-original][lazyload]属性选择器
    //console.log(eles);
    const lazyload=function() {//监听滚动事件
        Array.prototype.forEach.call(eles, function(item,index){
            //eles是一个类数组对象，需要将其转换为数组才能使用forEach方法。
            console.log(item);
            if(item.dataset.original==="") return;//如果图片元素有data-original属性
               //item是对象，dataset是对象的属性，data-original是属性名，""是属性值。
            rect=item.getBoundingClientRect();
            //img 标签对象在当前可视区中的位置信息。
            if(rect.top<viewHeight && rect.bottom > 0){//如果图片元素在可视区中,有必要渲染
                (function(){
                  var img = new Image();//创建一个新的图片对象，内存中的DOM对象，img对象
                  img.src = item.dataset.original;//将图片元素的data-original属性值赋值给图片对象的src属性
                  img.onload = function(){//当图片加载完成后,http请求完成后，有缓存cache,异步
                    //items.src = item.dataset.original; 图片大，网速慢，你会看到图片加载的过程，用户体验不好
                      item.src = item.dataset.original;//将图片对象的src属性值赋值给图片元素的src属性
                      item.removeAttribute('data-original');//不用再次迭代这个item,移除图片元素的data-original属性，垃圾回收，性能
                      item.removeAttribute('lazyload');//移除图片元素的lazyload属性，垃圾回收，性能
                    }  
                })()
            }
            })
    }
    window.addEventListener('scroll',lazyload )
    doucument.addEventListener('DOMContentLoaded',lazyload )//DOMContentLoaded事件在DOM加载完成后触发，
  </script>

</body>
</html>