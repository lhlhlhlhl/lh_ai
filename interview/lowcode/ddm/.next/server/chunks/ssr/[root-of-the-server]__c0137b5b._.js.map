{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hh/Desktop/lesson_si/interview/lowcode/ddm/lib/supabaseClient.ts"],"sourcesContent":["import {\r\n  createClient\r\n} from '@supabase/supabase-js'\r\nexport const supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n)\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAGO,MAAM,WAAW,IAAA,wUAAY","debugId":null}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hh/Desktop/lesson_si/interview/lowcode/ddm/app/FlowEditor.tsx"],"sourcesContent":["'use client';\r\nimport React, {\r\n  useCallback,\r\n  useState,\r\n  useEffect\r\n} from 'react'\r\nimport ReactFlow, {\r\n  Background,\r\n  Controls,\r\n  addEdge,\r\n  Connection,\r\n  Edge,\r\n  Node\r\n} from 'reactflow';\r\nimport 'reactflow/dist/style.css'\r\nimport {\r\n  supabase\r\n} from '@/lib/supabaseClient'\r\n\r\nexport default function FlowEditor() {\r\n  const [nodes, setNodes] = useState<Node[]>([\r\n    {\r\n      id:\"1\",\r\n      position: {\r\n        x: 100,\r\n        y: 100\r\n      },\r\n      data: {\r\n        label: '起点'\r\n      }\r\n    }\r\n  ])\r\n  const [edges, setEdges] = useState<Edge[]>([]);\r\n  const [nodeId, setNodeId] = useState(2);\r\n  const addNode = () => {\r\n    const newId = String(nodeId);\r\n    const newNode:Node = {\r\n      id: newId,\r\n      position: {\r\n        x: 100 + nodeId * 50,\r\n        y: 100\r\n      },\r\n      data: {\r\n        label: `节点 ${newId}`\r\n      }\r\n    }\r\n    setNodes((nds) => [...nds, newNode]);\r\n    setEdges((edgs) => [\r\n      ...edgs,\r\n      {\r\n        id: `e${nodeId - 1}-${newId}`,\r\n        source: String(nodeId - 1),\r\n        target: newId,\r\n      }\r\n    ]);\r\n    setNodeId(id => id + 1);\r\n  }\r\n  const removeNode = () => {\r\n    if(nodes.length <= 1)return;\r\n    const lastNode = nodes[nodes.length-1]\r\n    setNodes(nds => nds.slice(0,-1))\r\n    setEdges(edgs => edgs.filter(e => e.source !== lastNode.id && e.target !== lastNode.id))\r\n    setNodeId(id => id - 1)\r\n  }\r\n  const saveFlow = async() => {\r\n    const {\r\n      error\r\n    }= await supabase.from('flows').insert({\r\n      name:\"demo flow\",\r\n      nodes,\r\n      edges\r\n    })\r\n    if(error) console.error(error)\r\n      else alert(\"保存成功\")\r\n  }\r\n  const onNodeDoubleClick = (_:React.MouseEvent, node:Node) => {\r\n    // console.log(node);\r\n    const newLabel = prompt(\"请输入新的节点内容\", \r\n      node.data.label as string);\r\n    if (newLabel !== null && newLabel.trim() !== '') {\r\n      setNodes(nds => \r\n        nds.map(n => \r\n          n.id === node.id? { ...n, data: {...n.data, label: newLabel}}:n\r\n        )\r\n      )\r\n    }\r\n  }\r\n  useEffect(()=>{\r\n    const loadFlow = async()=>{\r\n      const {data} = await supabase\r\n      .from('flows')\r\n      .select('*')\r\n      .order('created_at', {ascending: false})\r\n      .limit(1)\r\n      .single()\r\n      console.log(data)\r\n      if(data){\r\n        setNodes(data.nodes||[])\r\n        setEdges(data.edges||[])\r\n        const maxId = data.node?.map(\r\n          (n:Node)=>Number(n.id)\r\n        ).reduce((a:number,b:number)=>Math.max(a,b),1)\r\n      }\r\n    }\r\n    loadFlow()\r\n  }, [])\r\n  return (\r\n    <div style={{width:'100%', height: '100vh'}}>\r\n      <div style={{marginBottom: 10}}>\r\n        <button onClick={addNode} style={{marginRight: 10}}>添加节点</button>\r\n        <button onClick={removeNode} style={{marginRight: 10}}>移除节点</button>\r\n        <button onClick={saveFlow} style={{marginRight: 10}}>保存到supabase</button>\r\n      </div>\r\n      <ReactFlow\r\n        nodes={nodes}\r\n        onNodeDoubleClick={onNodeDoubleClick}\r\n        edges={edges}\r\n        fitView\r\n      >\r\n        <Background />\r\n        <Controls/>\r\n      </ReactFlow>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}