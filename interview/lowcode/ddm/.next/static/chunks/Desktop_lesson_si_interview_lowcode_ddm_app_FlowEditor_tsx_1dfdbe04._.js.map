{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hh/Desktop/lesson_si/interview/lowcode/ddm/app/FlowEditor.tsx"],"sourcesContent":["'use client';\r\nimport React, {\r\n  useCallback,\r\n  useState,\r\n  useEffect\r\n} from 'react'\r\nimport ReactFlow, {\r\n  Background,\r\n  Controls,\r\n  addEdge,\r\n  Connection,\r\n  Edge,\r\n  Node\r\n} from 'reactflow';\r\nimport 'reactflow/dist/style.css'\r\n\r\nexport default function FlowEditor() {\r\n  const [nodes, setNodes] = useState<Node[]>([\r\n    {\r\n      id:\"1\",\r\n      position: {\r\n        x: 100,\r\n        y: 100\r\n      },\r\n      data: {\r\n        label: '起点'\r\n      }\r\n    }\r\n  ])\r\n  const [edges, setEdges] = useState<Edge[]>([]);\r\n  const [nodeId, setNodeId] = useState(2);\r\n  const addNode = () => {\r\n    const newId = String(nodeId);\r\n    const newNode:Node = {\r\n      id: newId,\r\n      position: {\r\n        x: 100 + nodeId * 50,\r\n        y: 100\r\n      },\r\n      data: {\r\n        label: `节点 ${newId}`\r\n      }\r\n    }\r\n    setNodes((nds) => [...nds, newNode]);\r\n    setEdges((edgs) => [\r\n      ...edgs,\r\n      {\r\n        id: `e${nodeId - 1}-${newId}`,\r\n        source: String(nodeId - 1),\r\n        target: newId,\r\n      }\r\n    ]);\r\n    setNodeId(id => id + 1);\r\n  }\r\n  const removeNode = () => {}\r\n  const saveFlow = async() => {\r\n    const {\r\n      error\r\n    }= await supabase.from('flows').insert({\r\n      name:\"demo flow\",\r\n      nodes,\r\n      edges\r\n    })\r\n    if(error) console.error(error)\r\n      else alert(\"保存成功\")\r\n  }\r\n  const onNodeDoubleClick = (_:React.MouseEvent, node:Node) => {\r\n    // console.log(node);\r\n    const newLabel = prompt(\"请输入新的节点内容\", \r\n      node.data.label as string);\r\n    if (newLabel !== null && newLabel.trim() !== '') {\r\n      setNodes(nds => \r\n        nds.map(n => \r\n          n.id === node.id? { ...n, data: {...n.data, label: newLabel}}:n\r\n        )\r\n      )\r\n    }\r\n  }\r\n  return (\r\n    <div style={{width:'100%', height: '100vh'}}>\r\n      <div style={{marginBottom: 10}}>\r\n        <button onClick={addNode} style={{marginRight: 10}}>添加节点</button>\r\n        <button onClick={removeNode} style={{marginRight: 10}}>移除节点</button>\r\n        <button onClick={saveFlow} style={{marginRight: 10}}>保存到supabase</button>\r\n      </div>\r\n      <ReactFlow\r\n        nodes={nodes}\r\n        onNodeDoubleClick={onNodeDoubleClick}\r\n        edges={edges}\r\n        fitView\r\n      >\r\n        <Background />\r\n        <Controls/>\r\n      </ReactFlow>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AACA;AAKA;AAAA;AAAA;;;AANA;;;;AAgBe,SAAS;;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,+VAAQ,EAAS;QACzC;YACE,IAAG;YACH,UAAU;gBACR,GAAG;gBACH,GAAG;YACL;YACA,MAAM;gBACJ,OAAO;YACT;QACF;KACD;IACD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,+VAAQ,EAAS,EAAE;IAC7C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,+VAAQ,EAAC;IACrC,MAAM,UAAU;QACd,MAAM,QAAQ,OAAO;QACrB,MAAM,UAAe;YACnB,IAAI;YACJ,UAAU;gBACR,GAAG,MAAM,SAAS;gBAClB,GAAG;YACL;YACA,MAAM;gBACJ,OAAO,AAAC,MAAW,OAAN;YACf;QACF;QACA,SAAS,CAAC,MAAQ;mBAAI;gBAAK;aAAQ;QACnC,SAAS,CAAC,OAAS;mBACd;gBACH;oBACE,IAAI,AAAC,IAAiB,OAAd,SAAS,GAAE,KAAS,OAAN;oBACtB,QAAQ,OAAO,SAAS;oBACxB,QAAQ;gBACV;aACD;QACD,UAAU,CAAA,KAAM,KAAK;IACvB;IACA,MAAM,aAAa,KAAO;IAC1B,MAAM,WAAW;QACf,MAAM,EACJ,KAAK,EACN,GAAE,MAAM,SAAS,IAAI,CAAC,SAAS,MAAM,CAAC;YACrC,MAAK;YACL;YACA;QACF;QACA,IAAG,OAAO,QAAQ,KAAK,CAAC;aACjB,MAAM;IACf;IACA,MAAM,oBAAoB,CAAC,GAAoB;QAC7C,qBAAqB;QACrB,MAAM,WAAW,OAAO,aACtB,KAAK,IAAI,CAAC,KAAK;QACjB,IAAI,aAAa,QAAQ,SAAS,IAAI,OAAO,IAAI;YAC/C,SAAS,CAAA,MACP,IAAI,GAAG,CAAC,CAAA,IACN,EAAE,EAAE,KAAK,KAAK,EAAE,GAAE;wBAAE,GAAG,CAAC;wBAAE,MAAM;4BAAC,GAAG,EAAE,IAAI;4BAAE,OAAO;wBAAQ;oBAAC,IAAE;QAGpE;IACF;IACA,qBACE,mXAAC;QAAI,OAAO;YAAC,OAAM;YAAQ,QAAQ;QAAO;;0BACxC,mXAAC;gBAAI,OAAO;oBAAC,cAAc;gBAAE;;kCAC3B,mXAAC;wBAAO,SAAS;wBAAS,OAAO;4BAAC,aAAa;wBAAE;kCAAG;;;;;;kCACpD,mXAAC;wBAAO,SAAS;wBAAY,OAAO;4BAAC,aAAa;wBAAE;kCAAG;;;;;;kCACvD,mXAAC;wBAAO,SAAS;wBAAU,OAAO;4BAAC,aAAa;wBAAE;kCAAG;;;;;;;;;;;;0BAEvD,mXAAC,mXAAS;gBACR,OAAO;gBACP,mBAAmB;gBACnB,OAAO;gBACP,OAAO;;kCAEP,mXAAC,iVAAU;;;;;kCACX,mXAAC,6UAAQ;;;;;;;;;;;;;;;;;AAIjB;GAhFwB;KAAA","debugId":null}}]
}